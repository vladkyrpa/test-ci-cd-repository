name: "Generate Promotion Logs"

on:
  pull_request:
    branches:
      - main
    types: [opened, synchronize, reopened] # Runs whenever the PR is updated

permissions:
  contents: read      # To read commits
  pull-requests: write # To edit the PR body

jobs:
  update-body:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Get all history so we can compare branches
        run: |
                git fetch origin main
                
                # Extract specific types
                FEATS=$(git log origin/main..HEAD --oneline --pretty=format:"* %s" | grep "^feat" || true)
                FIXES=$(git log origin/main..HEAD --oneline --pretty=format:"* %s" | grep "^fix" || true)
                
                # Build the body string
                BODY="## ðŸ“¦ Promotion Details%0A%0A"
                
                if [ ! -z "$FEATS" ]; then
                  BODY="${BODY}### ðŸš€ Features%0A${FEATS}%0A%0A"
                fi
                
                if [ ! -z "$FIXES" ]; then
                  BODY="${BODY}### ðŸ› Bug Fixes%0A${FIXES}%0A%0A"
                fi
                
                # Use printf to handle newlines correctly for the GH CLI
                echo -e "$BODY" > pr_body.txt
                gh pr edit ${{ github.event.pull_request.number }} --body-file pr_body.txt
              env:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
